name: Validate Pull Request

on:
  pull_request:
    branches: [ main ]
    paths:
      - '01-FUNDAMENTALS/**/*.md'
      - '02-SOFTWARE-ENGINEERING/**/*.md'
      - '03-HARDWARE/**/*.md'
      - '04-ARTIFICIAL-INTELLIGENCE/**/*.md'
      - '05-SYSTEMS/**/*.md'
      - '06-SECURITY/**/*.md'
      - '07-DATA-SCIENCE/**/*.md'
      - '08-WEB-DEVELOPMENT/**/*.md'
      - '09-MOBILE-DEVELOPMENT/**/*.md'
      - '10-GAME-DEVELOPMENT/**/*.md'
      - '11-SPECIALIZED-DOMAINS/**/*.md'
      - '12-META-SKILLS/**/*.md'

jobs:
  validate:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Basic validation checks
      run: |
        echo "Running basic validation checks..."
        echo "Checking for trailing whitespace..."
        if git diff --name-only origin/main...HEAD | grep '\.md$' | xargs grep -n "[[:space:]]$"; then
          echo "ERROR: Found trailing whitespace in changed files"
          exit 1
        fi
        echo "✓ No trailing whitespace found"
        
        echo "Checking for template placeholders..."
        if git diff --name-only origin/main...HEAD | grep '\.md$' | xargs grep -n "YYYY\|XXX\|TODO"; then
          echo "WARNING: Found placeholder text in changed files"
        fi
        
        echo "✓ Basic validation complete"
        
    - name: Verify file structure
      run: |
        echo "Verifying all category directories have required format files..."
        for category in $(find 01-FUNDAMENTALS 02-SOFTWARE-ENGINEERING 03-HARDWARE 04-ARTIFICIAL-INTELLIGENCE 05-SYSTEMS 06-SECURITY 07-DATA-SCIENCE 08-WEB-DEVELOPMENT 09-MOBILE-DEVELOPMENT 10-GAME-DEVELOPMENT 11-SPECIALIZED-DOMAINS 12-META-SKILLS -type d -mindepth 3 -maxdepth 5); do
          required_files="books.md papers.md courses.md videos.md interactive.md documentation.md tools.md podcasts-blogs.md"
          for file in $required_files; do
            if [ ! -f "$category/$file" ]; then
              echo "ERROR: Missing $file in $category"
              exit 1
            fi
          done
        done
        echo "✓ File structure validation complete"
        
    - name: Comment on PR
      uses: actions/github-script@v6
      with:
        script: |
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: '✅ Basic validation checks passed. Manual review recommended for content quality.'
          })
